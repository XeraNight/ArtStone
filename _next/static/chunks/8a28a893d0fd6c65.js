(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63867,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(68499),l=e.i(78894);function i({open:e,onOpenChange:a,invoiceNumber:i,onConfirm:n,isDeleting:r=!1}){return(0,s.jsx)(t.AlertDialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(t.AlertDialogContent,{children:[(0,s.jsxs)(t.AlertDialogHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:(0,s.jsx)(l.AlertTriangle,{className:"h-6 w-6 text-destructive"})}),(0,s.jsx)(t.AlertDialogTitle,{children:"Vymazať faktúru"})]}),(0,s.jsxs)(t.AlertDialogDescription,{className:"text-left pt-4",children:["Naozaj chcete vymazať faktúru ",(0,s.jsxs)("strong",{className:"text-foreground",children:['"',i,'"']}),"?",(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),"Táto akcia je nevratná a faktúra bude trvalo odstránená vrátane všetkých položiek."]})]}),(0,s.jsxs)(t.AlertDialogFooter,{children:[(0,s.jsx)(t.AlertDialogCancel,{disabled:r,children:"Zrušiť"}),(0,s.jsx)(t.AlertDialogAction,{onClick:e=>{e.preventDefault(),n()},disabled:r,className:"bg-destructive hover:bg-destructive/90",children:r?"Vymazávam...":"Vymazať"})]})]})})}var n=e.i(19455),r=e.i(55593),c=e.i(87486),d=e.i(15288),o=e.i(2747),x=e.i(40803),m=e.i(84774),u=e.i(67489),h=e.i(11795),j=e.i(7233),p=e.i(55436),v=e.i(40160),g=e.i(75254);let N=(0,g.default)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var y=e.i(41071),b=e.i(86536),f=e.i(14764),C=e.i(27612),k=e.i(55146),S=e.i(52169),w=e.i(2335),T=e.i(4049),_=e.i(44141),D=e.i(65268),P=e.i(10204),I=e.i(24687),z=e.i(76639),V=e.i(31278),F=e.i(21557),H=e.i(78583);let q=(0,g.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var M=e.i(46696);function L({open:e,onOpenChange:t}={}){let[l,i]=(0,a.useState)(!1),c=void 0!==e,d=c?t:i,[o,x]=(0,a.useState)("quote"),[h,p]=(0,a.useState)(""),[v,g]=(0,a.useState)(""),[N,y]=(0,a.useState)(""),[b,f]=(0,a.useState)(""),[k,w]=(0,a.useState)(0),[B,A]=(0,a.useState)(0),[O,Z]=(0,a.useState)([]),[R,U]=(0,a.useState)("custom"),[K,E]=(0,a.useState)(""),[$,Q]=(0,a.useState)(1),[G,J]=(0,a.useState)(0),W=(0,S.useCreateInvoice)(),{data:X=[]}=(0,T.useClients)(),{data:Y=[]}=(0,_.useInventoryItems)(),{data:ee=[]}=(0,D.useQuotes)({status:"accepted"}),{data:es}=(0,D.useQuote)(h),ea=(0,a.useMemo)(()=>O.reduce((e,s)=>e+s.quantity*s.unit_price,0),[O]),et=Math.max(0,ea-k)+B,el=.2*et,ei=et+el;(0,a.useEffect)(()=>{es&&"quote"===o&&(g(es.client_id??""),f(es.notes||""),w(es.discount||0),A(es.shipping||0),es.items&&es.items.length>0&&Z(es.items.map(e=>({id:Math.random().toString(36).substr(2,9),description:e.description,quantity:e.quantity,unit_price:e.unit_price,inventory_item_id:e.inventory_item_id}))))},[es,o]);let en=async()=>{if(!v)return void M.toast.error("Vyberte klienta");if(0===O.length)return void M.toast.error("Pridajte aspoň jednu položku");try{await W.mutateAsync({client_id:v,quote_id:"quote"===o&&h?h:void 0,due_date:N||void 0,notes:b||void 0,items:O.map(e=>({description:e.description,quantity:e.quantity,unit_price:e.unit_price,inventory_item_id:e.inventory_item_id}))}),M.toast.success("Faktúra vytvorená"),d(!1),x("quote"),p(""),g(""),y(""),f(""),w(0),A(0),Z([])}catch(e){console.error("Create invoice error:",e),M.toast.error(e.message||"Nepodarilo sa vytvoriť faktúru"),e.details&&M.toast.error(e.details)}};return(0,s.jsxs)(z.Dialog,{open:c?e:l,onOpenChange:d,children:[(0,s.jsx)(z.DialogTrigger,{asChild:!0,children:(0,s.jsxs)(n.Button,{className:"gradient-primary shadow-glow hover:shadow-lg transition-all",children:[(0,s.jsx)(j.Plus,{className:"h-4 w-4 mr-2"}),"Nová faktúra"]})}),(0,s.jsxs)(z.DialogContent,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(z.DialogHeader,{children:(0,s.jsx)(z.DialogTitle,{children:"Vytvoriť novú faktúru"})}),(0,s.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,s.jsxs)("div",{className:"flex gap-2 p-1 bg-muted rounded-lg",children:[(0,s.jsxs)(n.Button,{type:"button",variant:"quote"===o?"default":"ghost",size:"sm",className:"flex-1",onClick:()=>x("quote"),children:[(0,s.jsx)(H.FileText,{className:"h-4 w-4 mr-2"}),"Z ponuky"]}),(0,s.jsxs)(n.Button,{type:"button",variant:"scratch"===o?"default":"ghost",size:"sm",className:"flex-1",onClick:()=>{x("scratch"),p("")},children:[(0,s.jsx)(q,{className:"h-4 w-4 mr-2"}),"Od začiatku"]})]}),"quote"===o&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Vyberte ponuku *"}),(0,s.jsxs)(u.Select,{value:h,onValueChange:e=>{p(e)},children:[(0,s.jsx)(u.SelectTrigger,{children:(0,s.jsx)(u.SelectValue,{placeholder:"Vyberte akceptovanú ponuku"})}),(0,s.jsx)(u.SelectContent,{children:ee.map(e=>(0,s.jsxs)(u.SelectItem,{value:e.id,children:[e.quote_number," - ",e.client?.contact_name," (",e.total.toFixed(2)," €)"]},e.id))})]}),0===ee.length&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Žiadne akceptované ponuky. Akceptujte ponuku alebo vytvorte faktúru od začiatku."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Klient *"}),(0,s.jsxs)(u.Select,{value:v,onValueChange:g,children:[(0,s.jsx)(u.SelectTrigger,{children:(0,s.jsx)(u.SelectValue,{placeholder:"Vyberte klienta"})}),(0,s.jsx)(u.SelectContent,{children:X.map(e=>(0,s.jsxs)(u.SelectItem,{value:e.id,children:[e.contact_name," ",e.company_name?`(${e.company_name})`:""]},e.id))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Splatnosť"}),(0,s.jsx)(r.Input,{type:"date",value:N,onChange:e=>y(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"space-y-4 border rounded-lg p-4 bg-muted/20",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 font-medium",children:[(0,s.jsx)(F.Calculator,{className:"h-4 w-4"}),"Položky faktúry"]}),O.length>0&&(0,s.jsxs)(m.Table,{children:[(0,s.jsx)(m.TableHeader,{children:(0,s.jsxs)(m.TableRow,{children:[(0,s.jsx)(m.TableHead,{children:"Popis"}),(0,s.jsx)(m.TableHead,{className:"w-[100px] text-right",children:"Množstvo"}),(0,s.jsx)(m.TableHead,{className:"w-[120px] text-right",children:"Cena/ks"}),(0,s.jsx)(m.TableHead,{className:"w-[120px] text-right",children:"Spolu"}),(0,s.jsx)(m.TableHead,{className:"w-[50px]"})]})}),(0,s.jsx)(m.TableBody,{children:O.map(e=>(0,s.jsxs)(m.TableRow,{children:[(0,s.jsx)(m.TableCell,{children:e.description}),(0,s.jsx)(m.TableCell,{className:"text-right",children:e.quantity}),(0,s.jsxs)(m.TableCell,{className:"text-right",children:[e.unit_price.toFixed(2)," €"]}),(0,s.jsxs)(m.TableCell,{className:"text-right",children:[(e.quantity*e.unit_price).toFixed(2)," €"]}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(n.Button,{variant:"ghost",size:"icon-sm",onClick:()=>{var s;return s=e.id,void Z(O.filter(e=>e.id!==s))},children:(0,s.jsx)(C.Trash2,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},e.id))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-card p-3 rounded border",children:[(0,s.jsxs)("div",{className:"md:col-span-3 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Predloha (Sklad)"}),(0,s.jsxs)(u.Select,{value:R,onValueChange:e=>{if(U(e),"custom"===e)E(""),J(0);else{let s=Y.find(s=>s.id===e);s&&(E(s.name),J(s.sale_price||0))}},children:[(0,s.jsx)(u.SelectTrigger,{className:"h-8",children:(0,s.jsx)(u.SelectValue,{placeholder:"Vlastná položka"})}),(0,s.jsxs)(u.SelectContent,{children:[(0,s.jsx)(u.SelectItem,{value:"custom",children:"Vlastná položka"}),Y.map(e=>(0,s.jsxs)(u.SelectItem,{value:e.id,children:[e.name," (",e.qty_available," ks)"]},e.id))]})]})]}),(0,s.jsxs)("div",{className:"md:col-span-4 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Popis *"}),(0,s.jsx)(r.Input,{className:"h-8",value:K,onChange:e=>E(e.target.value),placeholder:"Názov položky alebo služby"})]}),(0,s.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Množstvo *"}),(0,s.jsx)(r.Input,{type:"number",className:"h-8",min:"1",value:$,onChange:e=>Q(parseInt(e.target.value)||0)})]}),(0,s.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Cena/ks (€)"}),(0,s.jsx)(r.Input,{type:"number",className:"h-8",min:"0",step:"0.01",value:G,onChange:e=>J(parseFloat(e.target.value)||0)})]}),(0,s.jsx)("div",{className:"md:col-span-1",children:(0,s.jsx)(n.Button,{size:"sm",className:"w-full h-8",onClick:()=>{K?$<=0?M.toast.error("Množstvo musí byť väčšie ako 0"):(Z([...O,{id:Math.random().toString(36).substr(2,9),description:K,quantity:$,unit_price:G,inventory_item_id:"custom"===R?void 0:R}]),U("custom"),E(""),Q(1),J(0)):M.toast.error("Popis položky je povinný")},children:(0,s.jsx)(j.Plus,{className:"h-4 w-4"})})})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-8 pt-4 border-t",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Základ (bez DPH)"}),(0,s.jsxs)("p",{className:"font-medium",children:[ea.toFixed(2)," €"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"DPH (20%)"}),(0,s.jsxs)("p",{className:"font-medium",children:[el.toFixed(2)," €"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Spolu s DPH"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-primary",children:[ei.toFixed(2)," €"]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Poznámka"}),(0,s.jsx)(I.Textarea,{placeholder:"Interná poznámka k faktúre...",value:b,onChange:e=>f(e.target.value)})]})]}),(0,s.jsxs)(z.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>d(!1),children:"Zrušiť"}),(0,s.jsx)(n.Button,{onClick:en,disabled:W.isPending,children:W.isPending?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(V.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Vytváram..."]}):"Vytvoriť faktúru"})]})]})]})}var B=e.i(6700);let A={draft:"Návrh",sent:"Odoslaná",paid:"Zaplatená",overdue:"Po splatnosti",cancelled:"Zrušená"};function O({invoice:e,open:t,onOpenChange:l}){let[i,c]=(0,a.useState)(""),[d,o]=(0,a.useState)(""),[x,h]=(0,a.useState)("draft"),[p,g]=(0,a.useState)(""),[N,y]=(0,a.useState)([]),[b,f]=(0,a.useState)("custom"),[k,w]=(0,a.useState)(""),[D,H]=(0,a.useState)(1),[q,L]=(0,a.useState)(0),O=(0,S.useUpdateInvoice)(),{data:Z=[]}=(0,T.useClients)(),{data:R=[]}=(0,_.useInventoryItems)();(0,a.useEffect)(()=>{e&&t&&(c(e.client_id??""),o(e.due_date||""),h(e.status),g(e.notes||""),e.items?y(e.items.map(e=>({id:Math.random().toString(36).substr(2,9),db_id:e.id,description:e.description,quantity:e.quantity,unit_price:e.unit_price,inventory_item_id:e.inventory_item_id??void 0}))):y([]))},[e,t]);let U=(0,a.useMemo)(()=>N.reduce((e,s)=>e+s.quantity*s.unit_price,0),[N]),K=.2*U,E=U+K,$=async()=>{if(e){if(!i)return void M.toast.error("Vyberte klienta");if(0===N.length)return void M.toast.error("Pridajte aspoň jednu položku");try{await O.mutateAsync({id:e.id,client_id:i,due_date:d||void 0,status:x,notes:p||void 0,items:N.map(e=>({description:e.description,quantity:e.quantity,unit_price:e.unit_price,inventory_item_id:e.inventory_item_id}))}),M.toast.success("Faktúra bola aktualizovaná"),l(!1)}catch(e){console.error("Update invoice error:",e),M.toast.error(e.message||"Nepodarilo sa aktualizovať faktúru")}}};return!e&&t?(0,s.jsx)(z.Dialog,{open:t,onOpenChange:l,children:(0,s.jsx)(z.DialogContent,{children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-40 space-y-4",children:[(0,s.jsx)(V.Loader2,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Načítavam detaily faktúry..."})]})})}):(0,s.jsx)(z.Dialog,{open:t,onOpenChange:l,children:(0,s.jsxs)(z.DialogContent,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(z.DialogHeader,{children:(0,s.jsxs)(z.DialogTitle,{children:["Detail faktúry ",e?.invoice_number]})}),(0,s.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Klient"}),(0,s.jsxs)(u.Select,{value:i,onValueChange:c,children:[(0,s.jsx)(u.SelectTrigger,{children:(0,s.jsx)(u.SelectValue,{placeholder:"Vyberte klienta"})}),(0,s.jsx)(u.SelectContent,{children:Z.map(e=>(0,s.jsx)(u.SelectItem,{value:e.id,children:e.contact_name},e.id))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Splatnosť"}),(0,s.jsx)(r.Input,{type:"date",value:d,onChange:e=>o(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Status"}),(0,s.jsxs)(u.Select,{value:x,onValueChange:e=>h(e),children:[(0,s.jsx)(u.SelectTrigger,{children:(0,s.jsx)(u.SelectValue,{})}),(0,s.jsx)(u.SelectContent,{children:Object.entries(A).map(([e,a])=>(0,s.jsx)(u.SelectItem,{value:e,children:a},e))})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4 border rounded-lg p-4 bg-muted/20",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 font-medium",children:[(0,s.jsx)(F.Calculator,{className:"h-4 w-4"}),"Položky faktúry"]}),(0,s.jsx)("div",{className:"rounded-md border bg-card",children:(0,s.jsxs)(m.Table,{children:[(0,s.jsx)(m.TableHeader,{children:(0,s.jsxs)(m.TableRow,{children:[(0,s.jsx)(m.TableHead,{children:"Popis"}),(0,s.jsx)(m.TableHead,{className:"w-[100px] text-right",children:"Množstvo"}),(0,s.jsx)(m.TableHead,{className:"w-[120px] text-right",children:"Cena/ks"}),(0,s.jsx)(m.TableHead,{className:"w-[120px] text-right",children:"Spolu"}),(0,s.jsx)(m.TableHead,{className:"w-[50px]"})]})}),(0,s.jsxs)(m.TableBody,{children:[0===N.length&&(0,s.jsx)(m.TableRow,{children:(0,s.jsx)(m.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"Žiadne položky"})}),N.map(e=>(0,s.jsxs)(m.TableRow,{children:[(0,s.jsx)(m.TableCell,{children:e.description}),(0,s.jsx)(m.TableCell,{className:"text-right",children:e.quantity}),(0,s.jsxs)(m.TableCell,{className:"text-right",children:[e.unit_price.toFixed(2)," €"]}),(0,s.jsxs)(m.TableCell,{className:"text-right",children:[(e.quantity*e.unit_price).toFixed(2)," €"]}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(n.Button,{variant:"ghost",size:"icon-sm",onClick:()=>{var s;return s=e.id,void y(N.filter(e=>e.id!==s))},children:(0,s.jsx)(C.Trash2,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},e.id))]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-card p-3 rounded border",children:[(0,s.jsxs)("div",{className:"md:col-span-3 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Sklad"}),(0,s.jsxs)(u.Select,{value:b,onValueChange:e=>{if(f(e),"custom"===e)w(""),L(0);else{let s=R.find(s=>s.id===e);s&&(w(s.name),L(s.sale_price||0))}},children:[(0,s.jsx)(u.SelectTrigger,{className:"h-8",children:(0,s.jsx)(u.SelectValue,{placeholder:"Vlastná položka"})}),(0,s.jsxs)(u.SelectContent,{children:[(0,s.jsx)(u.SelectItem,{value:"custom",children:"Vlastná položka"}),R.map(e=>(0,s.jsx)(u.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,s.jsxs)("div",{className:"md:col-span-4 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Popis"}),(0,s.jsx)(r.Input,{className:"h-8",value:k,onChange:e=>w(e.target.value)})]}),(0,s.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Počet"}),(0,s.jsx)(r.Input,{type:"number",className:"h-8",value:D,onChange:e=>H(Number(e.target.value))})]}),(0,s.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,s.jsx)(P.Label,{className:"text-xs",children:"Cena (€)"}),(0,s.jsx)(r.Input,{type:"number",className:"h-8",value:q,onChange:e=>L(Number(e.target.value))})]}),(0,s.jsx)("div",{className:"md:col-span-1",children:(0,s.jsx)(n.Button,{size:"sm",className:"w-full h-8",onClick:()=>{k?D<=0?M.toast.error("Množstvo musí byť väčšie ako 0"):(y([...N,{id:Math.random().toString(36).substr(2,9),description:k,quantity:D,unit_price:q,inventory_item_id:"custom"===b?void 0:b}]),f("custom"),w(""),H(1),L(0)):M.toast.error("Popis položky je povinný")},children:(0,s.jsx)(j.Plus,{className:"h-4 w-4"})})})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-8 pt-4 border-t",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Základ (bez DPH)"}),(0,s.jsxs)("p",{className:"font-medium",children:[U.toFixed(2)," €"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"DPH (20%)"}),(0,s.jsxs)("p",{className:"font-medium",children:[K.toFixed(2)," €"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Spolu s DPH"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-primary",children:[E.toFixed(2)," €"]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(P.Label,{children:"Poznámka"}),(0,s.jsx)(I.Textarea,{value:p,onChange:e=>g(e.target.value)})]})]}),(0,s.jsxs)(z.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,s.jsx)("div",{className:"flex-1 flex justify-start",children:(0,s.jsxs)(n.Button,{variant:"secondary",onClick:()=>{try{if(!e)return void M.toast.error("Chýbajú dáta faktúry");(0,B.generateInvoicePDF)(e),M.toast.success("PDF sa generuje...")}catch(e){console.error("PDF generation failed:",e),M.toast.error("Chyba pri generovaní PDF: "+e.message)}},children:[(0,s.jsx)(v.Download,{className:"h-4 w-4 mr-2"}),"Stiahnuť PDF"]})}),(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>l(!1),children:"Zrušiť"}),(0,s.jsx)(n.Button,{onClick:$,disabled:O.isPending,children:O.isPending?(0,s.jsx)(V.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):"Uložiť zmeny"})]})]})})}let Z={draft:"Návrh",sent:"Odoslaná",paid:"Zaplatená",overdue:"Po splatnosti",cancelled:"Zrušená"},R={draft:"secondary",sent:"info",paid:"success",overdue:"destructive",cancelled:"warning"};function U(){let[e,t]=(0,a.useState)(""),l=(0,w.useDebounce)(e,500),[g,T]=(0,a.useState)("all"),[_,D]=(0,a.useState)(null),[P,I]=(0,a.useState)(!1),[z,V]=(0,a.useState)(!1),[F,H]=(0,a.useState)(null),{data:q,isLoading:A,isError:U,error:K}=(0,S.useInvoices)(),{data:E}=(0,S.useInvoice)(_||""),$=(0,S.useUpdateInvoiceStatus)(),Q=(0,S.useDeleteInvoice)(),G=(0,a.useMemo)(()=>q?q.filter(e=>{if("all"!==g&&e.status!==g)return!1;if(l){let s=l.toLowerCase();return e.invoice_number.toLowerCase().includes(s)||(e.client?.contact_name||"").toLowerCase().includes(s)||(e.client?.company_name||"").toLowerCase().includes(s)}return!0}):[],[q,g,l]),J=e=>new Intl.NumberFormat("sk-SK",{style:"currency",currency:"EUR"}).format(e),W=G?.reduce((e,s)=>e+s.total,0)||0,X=G?.filter(e=>"paid"===e.status).reduce((e,s)=>e+s.total,0)||0,Y=G?.filter(e=>"overdue"===e.status).reduce((e,s)=>e+s.total,0)||0,ee=async(e,s)=>{try{await $.mutateAsync({invoiceId:e,status:s}),M.toast.success("Status faktúry aktualizovaný")}catch(e){M.toast.error("Nepodarilo sa aktualizovať status")}},es=e=>{D(e),I(!0)},ea=async(e,s)=>{try{let s=(0,h.createClient)(),{data:a,error:t}=await s.from("invoices").select(`
          *,
          client:clients(id, contact_name, company_name, email, phone, address),
          items:invoice_items(*)
        `).eq("id",e).single();if(t)throw t;a&&((0,B.generateInvoicePDF)(a),M.toast.success("PDF faktúry vygenerované"))}catch(e){console.error("Error generating PDF:",e),M.toast.error("Nepodarilo sa vygenerovať PDF")}},et=async()=>{if(F)try{await Q.mutateAsync(F.id),M.toast.success("Faktúra vymazaná"),H(null)}catch(e){console.error("Delete error:",e),M.toast.error("Nepodarilo sa vymazať faktúru")}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-1 gap-3",children:[(0,s.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,s.jsx)(p.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,s.jsx)(r.Input,{placeholder:"Hľadať podľa čísla, klienta...",value:e,onChange:e=>t(e.target.value),className:"pl-9"})]}),(0,s.jsxs)(u.Select,{value:g,onValueChange:T,children:[(0,s.jsx)(u.SelectTrigger,{className:"w-40",children:(0,s.jsx)(u.SelectValue,{placeholder:"Status"})}),(0,s.jsxs)(u.SelectContent,{children:[(0,s.jsx)(u.SelectItem,{value:"all",children:"Všetky statusy"}),Object.entries(Z).map(([e,a])=>(0,s.jsx)(u.SelectItem,{value:e,children:a},e))]})]})]}),(0,s.jsxs)(n.Button,{onClick:()=>V(!0),children:[(0,s.jsx)(j.Plus,{className:"mr-2 h-4 w-4"})," Nová faktúra"]}),(0,s.jsx)(L,{open:z,onOpenChange:V})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-4 mt-6",children:[(0,s.jsx)(d.Card,{className:"shadow-soft",children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Celkom faktúr"}),A?(0,s.jsx)(o.Skeleton,{className:"h-8 w-16 mt-1"}):(0,s.jsx)("p",{className:"text-2xl font-semibold",children:G?.length||0})]}),(0,s.jsx)(N,{className:"h-8 w-8 text-muted-foreground/50"})]})})}),(0,s.jsx)(d.Card,{className:"shadow-soft",children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Celková hodnota"}),A?(0,s.jsx)(o.Skeleton,{className:"h-8 w-24 mt-1"}):(0,s.jsx)("p",{className:"text-2xl font-semibold",children:J(W)})]})})}),(0,s.jsx)(d.Card,{className:"shadow-soft",children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Zaplatené"}),A?(0,s.jsx)(o.Skeleton,{className:"h-8 w-24 mt-1"}):(0,s.jsx)("p",{className:"text-2xl font-semibold text-success",children:J(X)})]})})}),(0,s.jsx)(d.Card,{className:"shadow-soft",children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Po splatnosti"}),A?(0,s.jsx)(o.Skeleton,{className:"h-8 w-24 mt-1"}):(0,s.jsx)("p",{className:"text-2xl font-semibold text-destructive",children:J(Y)})]})})})]}),(0,s.jsx)(d.Card,{className:"shadow-soft mt-6",children:(0,s.jsx)(d.CardContent,{className:"p-0",children:(0,s.jsxs)(m.Table,{children:[(0,s.jsx)(m.TableHeader,{children:(0,s.jsxs)(m.TableRow,{children:[(0,s.jsx)(m.TableHead,{children:"Číslo"}),(0,s.jsx)(m.TableHead,{children:"Klient"}),(0,s.jsx)(m.TableHead,{children:"Status"}),(0,s.jsx)(m.TableHead,{className:"text-right",children:"Suma"}),(0,s.jsx)(m.TableHead,{children:"Splatnosť"}),(0,s.jsx)(m.TableHead,{children:"Vytvoril"}),(0,s.jsx)(m.TableHead,{className:"w-12"})]})}),(0,s.jsx)(m.TableBody,{children:A?Array.from({length:5}).map((e,a)=>(0,s.jsxs)(m.TableRow,{children:[(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(o.Skeleton,{className:"h-5 w-24"})}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(o.Skeleton,{className:"h-5 w-32"})}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(o.Skeleton,{className:"h-5 w-20"})}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(o.Skeleton,{className:"h-5 w-20"})}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(o.Skeleton,{className:"h-5 w-24"})}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(o.Skeleton,{className:"h-5 w-28"})}),(0,s.jsx)(m.TableCell,{children:(0,s.jsx)(o.Skeleton,{className:"h-5 w-8"})})]},a)):G?.length===0?(0,s.jsx)(m.TableRow,{children:(0,s.jsx)(m.TableCell,{colSpan:7,className:"p-0",children:(0,s.jsx)(x.EmptyState,{icon:(0,s.jsx)(N,{className:"h-full w-full"}),title:e?"Nenašli sa žiadne výsledky":"Zatiaľ žiadne faktúry",description:e?`Pre v\xfdraz "${e}" sme nenašli žiadnu zhodu.`:"Vytvorte faktúru z akceptovanej ponuky alebo od začiatku.",action:{label:"Vytvoriť faktúru",onClick:()=>V(!0),icon:(0,s.jsx)(j.Plus,{className:"h-4 w-4"})}})})}):G?.map(e=>(0,s.jsxs)(m.TableRow,{className:"cursor-pointer hover:bg-muted/50",children:[(0,s.jsx)(m.TableCell,{onClick:()=>es(e.id),children:(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.invoice_number})}),(0,s.jsx)(m.TableCell,{onClick:()=>es(e.id),children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-foreground",children:e.client?.contact_name||"-"}),e.client?.company_name&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.client.company_name})]})}),(0,s.jsx)(m.TableCell,{onClick:()=>es(e.id),children:(0,s.jsx)(c.Badge,{variant:R[e.status],children:Z[e.status]})}),(0,s.jsx)(m.TableCell,{className:"text-right font-medium",onClick:()=>es(e.id),children:J(e.total)}),(0,s.jsx)(m.TableCell,{onClick:()=>es(e.id),children:(0,s.jsx)("span",{className:`text-sm ${"overdue"===e.status?"text-destructive font-medium":"text-muted-foreground"}`,children:e.due_date?new Date(e.due_date).toLocaleDateString("sk-SK"):"-"})}),(0,s.jsx)(m.TableCell,{onClick:()=>es(e.id),children:(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:e.created_by_user?.full_name||"-"})}),(0,s.jsx)(m.TableCell,{children:(0,s.jsxs)(k.DropdownMenu,{children:[(0,s.jsx)(k.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(n.Button,{variant:"ghost",size:"icon-sm",children:(0,s.jsx)(y.MoreHorizontal,{className:"h-4 w-4"})})}),(0,s.jsxs)(k.DropdownMenuContent,{align:"end",children:[(0,s.jsxs)(k.DropdownMenuItem,{onClick:()=>es(e.id),children:[(0,s.jsx)(b.Eye,{className:"h-4 w-4 mr-2"}),"Zobraziť / Upraviť"]}),(0,s.jsxs)(k.DropdownMenuItem,{onClick:()=>ea(e.id,e.invoice_number),children:[(0,s.jsx)(v.Download,{className:"h-4 w-4 mr-2"}),"Stiahnuť PDF"]}),"draft"===e.status&&(0,s.jsxs)(k.DropdownMenuItem,{onClick:()=>ee(e.id,"sent"),children:[(0,s.jsx)(f.Send,{className:"h-4 w-4 mr-2"}),"Odoslať klientovi"]}),"sent"===e.status&&(0,s.jsx)(k.DropdownMenuItem,{onClick:()=>ee(e.id,"paid"),children:"Označiť ako zaplatenú"}),(0,s.jsxs)(k.DropdownMenuItem,{className:"text-destructive",onClick:()=>H({id:e.id,number:e.invoice_number}),children:[(0,s.jsx)(C.Trash2,{className:"h-4 w-4 mr-2"}),"Vymazať"]})]})]})})]},e.id))})]})})}),(0,s.jsx)(O,{open:P,onOpenChange:I,invoice:E||null}),(0,s.jsx)(i,{open:!!F,onOpenChange:e=>!e&&H(null),invoiceNumber:F?.number||"",onConfirm:et,isDeleting:Q.isPending})]})}e.s(["InvoicesClientView",()=>U],63867)},80412,e=>{e.n(e.i(63867))}]);