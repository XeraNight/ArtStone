(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2335,e=>{"use strict";var t=e.i(71645);function a(e,a){let[i,s]=(0,t.useState)(e);return(0,t.useEffect)(()=>{let t=setTimeout(()=>{s(e)},a);return()=>{clearTimeout(t)}},[e,a]),i}e.s(["useDebounce",()=>a])},10204,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(48425),s=a.forwardRef((e,a)=>(0,t.jsx)(i.Primitive.label,{...e,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));s.displayName="Label";var r=e.i(25913),n=e.i(75157);let o=(0,r.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=a.forwardRef(({className:e,...a},i)=>(0,t.jsx)(s,{ref:i,className:(0,n.cn)(o(),e),...a}));u.displayName=s.displayName,e.s(["Label",()=>u],10204)},24687,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(75157);let s=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...a}));s.displayName="Textarea",e.s(["Textarea",()=>s])},48256,e=>{"use strict";let t=(0,e.i(75254).default)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);e.s(["Globe",()=>t],48256)},72520,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],72520)},63488,e=>{"use strict";let t=(0,e.i(75254).default)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);e.s(["Mail",()=>t],63488)},43432,e=>{"use strict";let t=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>t],43432)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},51975,e=>{"use strict";let t=(0,e.i(75254).default)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);e.s(["Tag",()=>t],51975)},83942,e=>{"use strict";var t=e.i(66027),a=e.i(11795),i=e.i(57951);let s=[{id:"ba",name:"Bratislavský kraj"},{id:"tt",name:"Trnavský kraj"},{id:"tn",name:"Trenčiansky kraj"},{id:"nr",name:"Nitriansky kraj"},{id:"za",name:"Žilinský kraj"},{id:"bb",name:"Banskobystrický kraj"},{id:"po",name:"Prešovský kraj"},{id:"ke",name:"Košický kraj"}];function r(){let{user:e}=(0,i.useAuth)();return(0,t.useQuery)({queryKey:["regions","v2"],queryFn:async()=>{try{let{data:e,error:t}=await a.supabase.from("regions").select("*").order("name");if(t)return console.warn("[useRegions] Error fetching regions, using fallback:",t),s;if(!e||0===e.length)return console.warn("[useRegions] No regions returned (RLS?), using fallback"),s;return e}catch(e){return console.error("[useRegions] Exception:",e),s}},staleTime:3e5,retry:!1})}e.s(["useRegions",()=>r],83942)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},48065,87316,e=>{"use strict";var t=e.i(66027),a=e.i(54616),i=e.i(12598),s=e.i(11795),r=e.i(57951);function n(e){let{user:a}=(0,r.useAuth)();return(0,t.useQuery)({queryKey:["activities",e],queryFn:async()=>{let t=s.supabase.from("activities").select("*").order("created_at",{ascending:!1});e?.entityType&&(t=t.eq("entity_type",e.entityType)),e?.entityId&&(t=t.eq("entity_id",e.entityId)),e?.limit&&(t=t.limit(e.limit));let{data:a,error:i}=await t;if(i)throw i;return a},enabled:!!a})}function o(){let e=(0,i.useQueryClient)(),{user:t}=(0,r.useAuth)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:i}=await s.supabase.from("activities").insert({...e,created_by:t?.id}).select().single();if(i)throw i;return a},onSuccess:()=>{e.invalidateQueries({queryKey:["activities"]}),e.invalidateQueries({queryKey:["recent-activities"]})}})}e.s(["useActivities",()=>n,"useCreateActivity",()=>o],48065);let u=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>u],87316)},99353,e=>{"use strict";let t=(0,e.i(75254).default)("sticky-note",[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]]);e.s(["StickyNote",()=>t],99353)},27516,e=>{"use strict";let t=(0,e.i(75254).default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["History",()=>t],27516)},97104,e=>{"use strict";var t=e.i(66027),a=e.i(54616),i=e.i(12598),s=e.i(11795),r=e.i(57951);function n(e){let{user:a}=(0,r.useAuth)();return(0,t.useQuery)({queryKey:["leads",e],queryFn:async()=>{let t=[];console.log("useLeads: fetching leads");let{data:a,error:i}=await s.supabase.from("leads").select("*").order("created_at",{ascending:!1});if(console.log("useLeads: Supabase response",{dbData:a,error:i}),i)throw console.error("useLeads: Error fetching leads",i),i;if(t=a,e?.status&&(t=t.filter(t=>t.status===e.status)),e?.source&&(t=t.filter(t=>t.source_type===e.source)),e?.regionId&&(t=t.filter(t=>t.region_id===e.regionId)),e?.assignedUserId&&(t=t.filter(t=>t.assigned_user_id===e.assignedUserId)),e?.search){let a=e.search.toLowerCase();t=t.filter(e=>e.contact_name?.toLowerCase().includes(a)||e.email?.toLowerCase().includes(a)||e.company_name?.toLowerCase().includes(a))}return t},enabled:!!a})}function o(e){return(0,t.useQuery)({queryKey:["leads",e],queryFn:async()=>{let{data:t,error:a}=await s.supabase.from("leads").select(`
          *,
          region:regions(id, name),
          assigned_user:profiles!leads_assigned_user_id_fkey(id, full_name, email)
        `).eq("id",e).single();if(a)throw a;return t},enabled:!!e})}function u(){let e=(0,i.useQueryClient)(),{user:t}=(0,r.useAuth)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:i}=await s.supabase.from("leads").insert({contact_name:e.contact_name,company_name:e.company_name,email:e.email,phone:e.phone,address:e.address,postal_code:e.postal_code,region_id:e.region_id,status:e.status||"new",source_type:e.source_type||"manual",notes:e.notes,assigned_user_id:e.assigned_user_id||t?.id,created_by:t?.id}).select().single();if(i)throw console.error("Supabase create lead error:",i),i;return a},onSuccess:()=>{e.invalidateQueries({queryKey:["leads"]}),e.invalidateQueries({queryKey:["recent-leads"]}),e.invalidateQueries({queryKey:["dashboard-stats"]})},onError:e=>{console.error("Mutation create lead error:",e)}})}function d(){let e=(0,i.useQueryClient)();return(0,a.useMutation)({mutationFn:async({id:e,...t})=>{let{data:a,error:i}=await s.supabase.from("leads").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw console.error("Supabase update lead error:",i),i;return a},onSuccess:t=>{e.invalidateQueries({queryKey:["leads"]}),e.invalidateQueries({queryKey:["leads",t.id]})},onError:e=>{console.error("Mutation update lead error:",e)}})}function l(){let e=(0,i.useQueryClient)();return(0,a.useMutation)({mutationFn:async e=>{let{error:t}=await s.supabase.from("leads").delete().eq("id",e);if(t)throw t},onSuccess:()=>{e.invalidateQueries({queryKey:["leads"]}),e.invalidateQueries({queryKey:["dashboard-stats"]})}})}function c(){let e=(0,i.useQueryClient)(),{user:t}=(0,r.useAuth)();return(0,a.useMutation)({mutationFn:async({leadId:e,userId:a})=>{let{data:i,error:r}=await s.supabase.from("leads").update({assigned_user_id:a,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw r;if(await s.supabase.from("activities").insert({entity_type:"lead",entity_id:e,activity_type:"note",title:"Lead priradený",description:`Lead bol priraden\xfd nov\xe9mu obchodn\xedkovi`,created_by:t?.id}),a&&a!==t?.id){let{data:t}=await s.supabase.from("leads").select("contact_name,company_name").eq("id",e).single();await s.supabase.from("notifications").insert({user_id:a,type:"new_lead",title:"Nový lead priradený",message:`Lead ${t?.contact_name||t?.company_name||""} v\xe1m bol priraden\xfd`,entity_type:"lead",entity_id:e})}return i},onSuccess:()=>{e.invalidateQueries({queryKey:["leads"]}),e.invalidateQueries({queryKey:["activities"]})}})}function y(){let e=(0,i.useQueryClient)(),{user:t}=(0,r.useAuth)();return(0,a.useMutation)({mutationFn:async({leadId:e,status:a,note:i})=>{let{data:r,error:n}=await s.supabase.from("leads").update({status:a,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw n;return await s.supabase.from("activities").insert({entity_type:"lead",entity_id:e,activity_type:"status_change",title:"Zmena statusu",description:i||`Status zmenen\xfd na: ${a}`,created_by:t?.id}),r},onSuccess:()=>{e.invalidateQueries({queryKey:["leads"]}),e.invalidateQueries({queryKey:["activities"]})}})}function p(){let e=(0,i.useQueryClient)(),{user:t}=(0,r.useAuth)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:i}=await s.supabase.from("leads").update({assigned_user_id:null,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return await s.supabase.from("activities").insert({entity_type:"lead",entity_id:e,activity_type:"note",title:"Priradenie zrušené",description:"Lead bol oddelený od obchodníka",created_by:t?.id}),a},onSuccess:()=>{e.invalidateQueries({queryKey:["leads"]}),e.invalidateQueries({queryKey:["activities"]})}})}function m(){let e=(0,i.useQueryClient)(),{user:t}=(0,r.useAuth)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:i}=await s.supabase.from("leads").select("*").eq("id",e).single();if(i)throw i;if(!a)throw Error("Lead not found");if(a.converted_to_client_id)throw Error("Tento lead už bol konvertovaný na klienta");if(a.email){let{data:e}=await s.supabase.from("clients").select("id, contact_name").eq("email",a.email).single();if(e)throw Error(`Klient s emailom ${a.email} už existuje`)}let{data:r,error:n}=await s.supabase.from("clients").insert({contact_name:a.contact_name,company_name:a.company_name,email:a.email,phone:a.phone,address:a.address,postal_code:a.postal_code,region_id:a.region_id,assigned_user_id:a.assigned_user_id,notes:a.notes,status:"active",converted_from_lead_id:a.id,created_by:t?.id}).select().single();if(n)throw console.error("Error creating client:",n),n;let{data:o,error:u}=await s.supabase.from("activities").select("*").eq("entity_type","lead").eq("entity_id",e);if(!u&&o&&o.length>0){let e=o.map(e=>({entity_type:"client",entity_id:r.id,activity_type:e.activity_type,title:e.title,description:e.description,created_by:e.created_by,created_at:e.created_at}));await s.supabase.from("activities").insert(e)}let{error:d}=await s.supabase.from("leads").update({converted_to_client_id:r.id,converted_at:new Date().toISOString(),status:"won",updated_at:new Date().toISOString()}).eq("id",e);return d&&console.error("Error updating lead:",d),await s.supabase.from("activities").insert({entity_type:"client",entity_id:r.id,activity_type:"note",title:"Klient vytvorený z leadu",description:`Klient bol \xfaspešne konvertovan\xfd z leadu "${a.contact_name}"`,created_by:t?.id}),{client:r,lead:a,activitiesCopied:o?.length||0}},onSuccess:t=>{e.invalidateQueries({queryKey:["leads"]}),e.invalidateQueries({queryKey:["clients"]}),e.invalidateQueries({queryKey:["activities"]}),e.invalidateQueries({queryKey:["dashboard-stats"]}),e.invalidateQueries({queryKey:["recent-leads"]})},onError:e=>{console.error("Lead conversion error:",e)}})}e.s(["useAssignLead",()=>c,"useConvertLead",()=>m,"useCreateLead",()=>u,"useDeleteLead",()=>l,"useLead",()=>o,"useLeads",()=>n,"useUnassignLead",()=>p,"useUpdateLead",()=>d,"useUpdateLeadStatus",()=>y])},60914,e=>{"use strict";var t=e.i(66027),a=e.i(11795),i=e.i(57951);function s(){let{user:e}=(0,i.useAuth)();return(0,t.useQuery)({queryKey:["salespeople"],queryFn:async()=>{let t=a.supabase.from("profiles").select(`
          *,
          regions(id, name)
        `).eq("role","sales").eq("is_active",!0);e?.role==="manager"&&e.regionId&&(t=t.eq("region_id",e.regionId));let{data:i,error:s}=await t;if(s)throw s;return await Promise.all((i||[]).map(async e=>{let[t,i,s]=await Promise.all([a.supabase.from("leads").select("*",{count:"exact",head:!0}).eq("assigned_user_id",e.id),a.supabase.from("clients").select("*",{count:"exact",head:!0}).eq("assigned_user_id",e.id),a.supabase.from("quotes").select("*",{count:"exact",head:!0}).eq("created_by",e.id)]),r=t.count||0,n=i.count||0,o=r>0?Math.round(n/r*100):0;return{...e,role:"sales",region:e.regions,stats:{leads:r,clients:n,quotes:s.count||0,conversionRate:o,targetProgress:Math.min(100,Math.round(n/10*100))}}}))},enabled:!!e&&("admin"===e.role||"manager"===e.role||"správca"===e.role)})}e.s(["useSalespeople",()=>s])}]);