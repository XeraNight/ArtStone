(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7486,e=>{"use strict";let t=(0,e.i(75254).default)("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]]);e.s(["Building2",()=>t],7486)},63488,e=>{"use strict";let t=(0,e.i(75254).default)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);e.s(["Mail",()=>t],63488)},43432,e=>{"use strict";let t=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>t],43432)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},51975,e=>{"use strict";let t=(0,e.i(75254).default)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);e.s(["Tag",()=>t],51975)},83942,e=>{"use strict";var t=e.i(66027),a=e.i(11795),s=e.i(57951);let i=[{id:"ba",name:"Bratislavský kraj"},{id:"tt",name:"Trnavský kraj"},{id:"tn",name:"Trenčiansky kraj"},{id:"nr",name:"Nitriansky kraj"},{id:"za",name:"Žilinský kraj"},{id:"bb",name:"Banskobystrický kraj"},{id:"po",name:"Prešovský kraj"},{id:"ke",name:"Košický kraj"}];function l(){let{user:e}=(0,s.useAuth)();return(0,t.useQuery)({queryKey:["regions","v2"],queryFn:async()=>{try{let{data:e,error:t}=await a.supabase.from("regions").select("*").order("name");if(t)return console.warn("[useRegions] Error fetching regions, using fallback:",t),i;if(!e||0===e.length)return console.warn("[useRegions] No regions returned (RLS?), using fallback"),i;return e}catch(e){return console.error("[useRegions] Exception:",e),i}},staleTime:3e5,retry:!1})}e.s(["useRegions",()=>l],83942)},48065,87316,e=>{"use strict";var t=e.i(66027),a=e.i(54616),s=e.i(12598),i=e.i(11795),l=e.i(57951);function r(e){let{user:a}=(0,l.useAuth)();return(0,t.useQuery)({queryKey:["activities",e],queryFn:async()=>{let t=i.supabase.from("activities").select("*").order("created_at",{ascending:!1});e?.entityType&&(t=t.eq("entity_type",e.entityType)),e?.entityId&&(t=t.eq("entity_id",e.entityId)),e?.limit&&(t=t.limit(e.limit));let{data:a,error:s}=await t;if(s)throw s;return a},enabled:!!a})}function n(){let e=(0,s.useQueryClient)(),{user:t}=(0,l.useAuth)();return(0,a.useMutation)({mutationFn:async e=>{let{data:a,error:s}=await i.supabase.from("activities").insert({...e,created_by:t?.id}).select().single();if(s)throw s;return a},onSuccess:()=>{e.invalidateQueries({queryKey:["activities"]}),e.invalidateQueries({queryKey:["recent-activities"]})}})}e.s(["useActivities",()=>r,"useCreateActivity",()=>n],48065);let c=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>c],87316)},27516,e=>{"use strict";let t=(0,e.i(75254).default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["History",()=>t],27516)},99353,e=>{"use strict";let t=(0,e.i(75254).default)("sticky-note",[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]]);e.s(["StickyNote",()=>t],99353)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},81914,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(65268),i=e.i(4049),l=e.i(44141),r=e.i(19455),n=e.i(55593),c=e.i(10204),d=e.i(24687),o=e.i(76639),u=e.i(67489),h=e.i(84774),m=e.i(7233),x=e.i(27612),p=e.i(31278),y=e.i(21557),v=e.i(46696);function g({open:e,onOpenChange:j,defaultClientId:k}={}){let[b,f]=(0,a.useState)(!1),N=void 0!==e?e:b,C=e=>{j?j(e):f(e)},[w,S]=(0,a.useState)(""),[T,M]=(0,a.useState)(""),[_,q]=(0,a.useState)(""),[P,I]=(0,a.useState)([]),[F,H]=(0,a.useState)(0),[L,V]=(0,a.useState)(0),[z,A]=(0,a.useState)("custom"),[B,R]=(0,a.useState)(""),[D,K]=(0,a.useState)(1),[Q,U]=(0,a.useState)(0),O=(0,s.useCreateQuote)(),{data:Z=[]}=(0,i.useClients)(),{data:E=[]}=(0,l.useInventoryItems)();(0,a.useMemo)(()=>{k&&Z.length>0&&Z.find(e=>e.id===k)&&S(k)},[k,Z,N]),(0,a.useMemo)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("leadId"),a=e.get("action");if(t&&"new"===a&&Z.length>0){let e=Z.find(e=>e.lead_origin_id===t);e&&(S(e.id),C(!0))}},[Z]);let $=(0,a.useMemo)(()=>P.reduce((e,t)=>e+t.quantity*t.unit_price,0),[P]),G=Math.max(0,$-F+L),J=.2*G,W=G+J,X=async()=>{if(!w)return void v.toast.error("Vyberte klienta");if(0===P.length)return void v.toast.error("Pridajte aspoň jednu položku");try{await O.mutateAsync({client_id:w,valid_until:T||void 0,notes:_||void 0,discount:F,shipping:L,items:P.map(e=>({description:e.description,quantity:e.quantity,unit_price:e.unit_price,inventory_item_id:e.inventory_item_id}))}),v.toast.success("Cenová ponuka vytvorená"),C(!1),S(""),M(""),q(""),I([]),H(0),V(0),window.history.replaceState({},"",window.location.pathname)}catch(e){console.error("Create quote error:",e),v.toast.error(e.message||"Nepodarilo sa vytvoriť cenovú ponuku"),e.details&&v.toast.error(e.details)}};return(0,t.jsx)(o.Dialog,{open:N,onOpenChange:C,children:(0,t.jsxs)(o.DialogContent,{className:"max-w-[95vw] sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)(o.DialogHeader,{children:(0,t.jsx)(o.DialogTitle,{children:"Vytvoriť cenovú ponuku"})}),(0,t.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Klient *"}),(0,t.jsxs)(u.Select,{value:w,onValueChange:S,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Vyberte klienta"})}),(0,t.jsx)(u.SelectContent,{children:Z.map(e=>(0,t.jsxs)(u.SelectItem,{value:e.id,children:[e.contact_name," ",e.company_name?`(${e.company_name})`:""]},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Platnosť do"}),(0,t.jsx)(n.Input,{type:"date",value:T,onChange:e=>M(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"space-y-4 border rounded-lg p-4 bg-muted/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 font-medium",children:[(0,t.jsx)(y.Calculator,{className:"h-4 w-4"}),"Položky ponuky"]}),P.length>0&&(0,t.jsxs)(h.Table,{children:[(0,t.jsx)(h.TableHeader,{children:(0,t.jsxs)(h.TableRow,{children:[(0,t.jsx)(h.TableHead,{children:"Popis"}),(0,t.jsx)(h.TableHead,{className:"w-[100px] text-right",children:"Množstvo"}),(0,t.jsx)(h.TableHead,{className:"w-[120px] text-right",children:"Cena/ks"}),(0,t.jsx)(h.TableHead,{className:"w-[120px] text-right",children:"Spolu"}),(0,t.jsx)(h.TableHead,{className:"w-[50px]"})]})}),(0,t.jsx)(h.TableBody,{children:P.map(e=>(0,t.jsxs)(h.TableRow,{children:[(0,t.jsx)(h.TableCell,{children:e.description}),(0,t.jsx)(h.TableCell,{className:"text-right",children:e.quantity}),(0,t.jsxs)(h.TableCell,{className:"text-right",children:[e.unit_price.toFixed(2)," €"]}),(0,t.jsxs)(h.TableCell,{className:"text-right",children:[(e.quantity*e.unit_price).toFixed(2)," €"]}),(0,t.jsx)(h.TableCell,{children:(0,t.jsx)(r.Button,{variant:"ghost",size:"icon-sm",onClick:()=>{var t;return t=e.id,void I(P.filter(e=>e.id!==t))},children:(0,t.jsx)(x.Trash2,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},e.id))})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-card p-3 rounded border",children:[(0,t.jsxs)("div",{className:"md:col-span-3 space-y-2",children:[(0,t.jsx)(c.Label,{className:"text-xs",children:"Predloha (Sklad)"}),(0,t.jsxs)(u.Select,{value:z,onValueChange:e=>{if(A(e),"custom"===e)R(""),U(0);else{let t=E.find(t=>t.id===e);t&&(R(t.name),U(t.sale_price||0))}},children:[(0,t.jsx)(u.SelectTrigger,{className:"h-8",children:(0,t.jsx)(u.SelectValue,{placeholder:"Vlastná položka"})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"custom",children:"Vlastná položka"}),E.map(e=>(0,t.jsxs)(u.SelectItem,{value:e.id,children:[e.name," (",e.qty_available," ks)"]},e.id))]})]})]}),(0,t.jsxs)("div",{className:"md:col-span-4 space-y-2",children:[(0,t.jsx)(c.Label,{className:"text-xs",children:"Popis *"}),(0,t.jsx)(n.Input,{className:"h-8",value:B,onChange:e=>R(e.target.value),placeholder:"Názov položky alebo služby"})]}),(0,t.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,t.jsx)(c.Label,{className:"text-xs",children:"Množstvo *"}),(0,t.jsx)(n.Input,{type:"number",className:"h-8",min:"1",value:D,onChange:e=>K(parseInt(e.target.value)||0)})]}),(0,t.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,t.jsx)(c.Label,{className:"text-xs",children:"Cena/ks (€)"}),(0,t.jsx)(n.Input,{type:"number",className:"h-8",min:"0",step:"0.01",value:Q,onChange:e=>U(parseFloat(e.target.value)||0)})]}),(0,t.jsx)("div",{className:"md:col-span-1",children:(0,t.jsx)(r.Button,{size:"sm",className:"w-full h-8",onClick:()=>{B?D<=0?v.toast.error("Množstvo musí byť väčšie ako 0"):(I([...P,{id:Math.random().toString(36).substr(2,9),description:B,quantity:D,unit_price:Q,inventory_item_id:"custom"===z?void 0:z}]),A("custom"),R(""),K(1),U(0)):v.toast.error("Popis položky je povinný")},children:(0,t.jsx)(m.Plus,{className:"h-4 w-4"})})})]}),(0,t.jsxs)("div",{className:"grid gap-4 pt-4 border-t",children:[(0,t.jsxs)("div",{className:"flex justify-end gap-4 items-center",children:[(0,t.jsx)(c.Label,{className:"w-24 text-right",children:"Zľava (€)"}),(0,t.jsx)(n.Input,{type:"number",className:"w-32 h-8 text-right",min:"0",step:"0.01",value:F,onChange:e=>H(parseFloat(e.target.value)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 items-center",children:[(0,t.jsx)(c.Label,{className:"w-24 text-right",children:"Doprava (€)"}),(0,t.jsx)(n.Input,{type:"number",className:"w-32 h-8 text-right",min:"0",step:"0.01",value:L,onChange:e=>V(parseFloat(e.target.value)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-8 pt-2 mt-2 border-t border-dashed",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Základ"}),(0,t.jsxs)("p",{className:"font-medium",children:[$.toFixed(2)," €"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Upravený základ"}),(0,t.jsxs)("p",{className:"font-medium text-foreground",children:[($-F+L).toFixed(2)," €"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"DPH (20%)"}),(0,t.jsxs)("p",{className:"font-medium",children:[J.toFixed(2)," €"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Spolu s DPH"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-primary",children:[W.toFixed(2)," €"]})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Poznámka"}),(0,t.jsx)(d.Textarea,{placeholder:"Interná poznámka k ponuke...",value:_,onChange:e=>q(e.target.value)})]})]}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>C(!1),children:"Zrušiť"}),(0,t.jsx)(r.Button,{onClick:X,disabled:O.isPending,children:O.isPending?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Vytváram..."]}):"Vytvoriť ponuku"})]})]})})}e.s(["CreateQuoteDialog",()=>g])}]);